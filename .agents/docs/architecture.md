# SQLå­—æ®µçº§è¡€ç¼˜åˆ†æå¹³å° - æŠ€æœ¯æ¶æ„è®¾è®¡

> æ–‡æ¡£ç‰ˆæœ¬: v1.0  
> åˆ›å»ºæ—¶é—´: 2025-10-23  
> ä½œè€…: AI Task Engine  
> çŠ¶æ€: âœ… å·²å®Œæˆ

---

## 1. æŠ€æœ¯æ ˆé€‰å‹

### 1.1 åç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|-----|---------|------|---------|
| **æ ¸å¿ƒæ¡†æ¶** | Spring Boot | 2.7.x | å¿«é€Ÿå¼€å‘ã€ç”Ÿæ€æˆç†Ÿã€æ˜“äºéƒ¨ç½² |
| **SQLè§£æå™¨** | Alibaba Druid | 1.2.20 | âœ… æ”¯æŒå¤šæ•°æ®åº“æ–¹è¨€ï¼ˆHive/MySQL/Sparkï¼‰<br>âœ… ASTè®¿é—®è€…æ¨¡å¼<br>âœ… å›½äº§ã€æ–‡æ¡£å®Œå–„ |
| **ORMæ¡†æ¶** | MyBatis Plus | 3.5.3 | ä»£ç ç”Ÿæˆã€CRUDç®€åŒ–ã€æ€§èƒ½ä¼˜è‰¯ |
| **æ•°æ®åº“** | H2 (å¼€å‘) / MySQL (ç”Ÿäº§) | H2: 2.1.x<br>MySQL: 8.0+ | H2å†…åµŒéƒ¨ç½²ç®€å•ï¼ŒMySQLç”Ÿäº§ç¨³å®š |
| **XMLè§£æ** | DOM4J | 2.1.3 | Kettleæ–‡ä»¶ï¼ˆXMLï¼‰è§£æ |
| **Excelå¯¼å‡º** | EasyExcel | 3.3.2 | å¤§æ•°æ®é‡å¯¼å‡ºã€ä½å†…å­˜å ç”¨ |
| **å·¥å…·åº“** | Hutool | 5.8.16 | ä¸­æ–‡å‹å¥½çš„Javaå·¥å…·é›† |
| **æ—¥å¿—** | SLF4J + Logback | 1.7.36 | æ ‡å‡†æ—¥å¿—é—¨é¢ |

### 1.2 å‰ç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | é€‰å‹ç†ç”± |
|-----|---------|------|---------|
| **åŸºç¡€** | HTML5 + CSS3 + ES6+ | - | åŸç”Ÿå¼€å‘ï¼Œæ— æ¡†æ¶ä¾èµ– |
| **å›¾å½¢å¼•æ“** | AntV G6 | 4.8.x | âœ… å›½äº§å›¾å½¢åº“<br>âœ… ä¸“ä¸šDAG/è¡€ç¼˜å›¾<br>âœ… äº¤äº’èƒ½åŠ›å¼º |
| **è¡¨æ ¼ç»„ä»¶** | DataTables.js | 1.13.x | åŠŸèƒ½ä¸°å¯Œï¼ˆæ’åºã€æœç´¢ã€åˆ†é¡µï¼‰ |
| **æ ‘å½¢ç»„ä»¶** | jsTree | 3.3.x | å±‚çº§æ•°æ®å±•ç¤º |
| **HTTPå®¢æˆ·ç«¯** | Axios | 1.6.x | Promiseé£æ ¼ï¼Œæ‹¦æˆªå™¨æ”¯æŒ |
| **UIæ¡†æ¶** | è‡ªå®šä¹‰CSS + Flexbox | - | è½»é‡çº§ï¼Œé¿å…æ¡†æ¶è‡ƒè‚¿ |

### 1.3 æ•°æ®åº“æ–¹è¨€æ”¯æŒ

é€šè¿‡Druidçš„ `DbType` æšä¸¾æ”¯æŒï¼š

```java
// æ”¯æŒçš„æ•°æ®åº“ç±»å‹
DbType.hive    â†’ Apache Hive SQL
DbType.mysql   â†’ MySQL / MariaDB
DbType.spark   â†’ Apache Spark SQL
```

---

## 2. ç³»ç»Ÿæ¶æ„å›¾

### 2.1 æ€»ä½“æ¶æ„ï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·å±‚ (Browser)                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ SQLè¾“å…¥ç•Œé¢ â”‚  â”‚ è¡€ç¼˜å¯è§†åŒ– â”‚  â”‚ å…ƒæ•°æ®ç®¡ç† â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚               â”‚               â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      HTTP REST API
                      (JSON)
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â†“               â†“               â†“                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          æ§åˆ¶å™¨å±‚ (Controller)                â”‚           â”‚
â”‚  â”‚  /lineage/analyze   /metadata/*   /export/*  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              æœåŠ¡å±‚ (Service)                 â”‚           â”‚
â”‚  â”‚  â€¢ DruidParserService   (SQLè§£æ)            â”‚           â”‚
â”‚  â”‚  â€¢ LineageAnalyzer      (è¡€ç¼˜åˆ†æå¼•æ“)       â”‚           â”‚
â”‚  â”‚  â€¢ KettleParserService  (Kettleè§£æ)         â”‚           â”‚
â”‚  â”‚  â€¢ MetadataService      (å…ƒæ•°æ®CRUD)         â”‚           â”‚
â”‚  â”‚  â€¢ ExportService        (å¯¼å‡º)               â”‚           â”‚
â”‚  â”‚  â€¢ BatchProcessor       (æ‰¹é‡å¼‚æ­¥)           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          æ•°æ®è®¿é—®å±‚ (Mapper/DAO)              â”‚           â”‚
â”‚  â”‚  MyBatis Plus                                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚           æ•°æ®åº“ (H2/MySQL)                   â”‚           â”‚
â”‚  â”‚  â€¢ metadata_*  (å…ƒæ•°æ®è¡¨)                    â”‚           â”‚
â”‚  â”‚  â€¢ lineage_*   (è¡€ç¼˜ç»“æœè¡¨)                  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                              â”‚
â”‚                  Spring Boot Application                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒåˆ†ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥SQL â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SQLé¢„å¤„ç†    â”‚  (å»æ³¨é‡Šã€æ ¼å¼åŒ–)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Druidè§£æ    â”‚ â†’ SQLStatement (AST)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ASTéå† (è®¿é—®è€…æ¨¡å¼) â”‚
â”‚  â€¢ æå–SELECTå­—æ®µ       â”‚
â”‚  â€¢ æå–FROMè¡¨           â”‚
â”‚  â€¢ æå–JOINæ¡ä»¶         â”‚
â”‚  â€¢ è§£æWHERE/GROUP BY   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å­—æ®µä¾èµ–è¿½è¸ª       â”‚
â”‚  â€¢ é€’å½’è§£æè¡¨è¾¾å¼     â”‚
â”‚  â€¢ åˆ«åæ˜ å°„           â”‚
â”‚  â€¢ å­æŸ¥è¯¢å­—æ®µä¼ æ’­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ„å»ºè¡€ç¼˜å›¾        â”‚  (DAGç»“æ„)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç»“æœåºåˆ—åŒ–        â”‚ â†’ JSON
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å‰ç«¯å¯è§†åŒ–        â”‚  (è¡¨æ ¼/æ ‘/å›¾)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ¨¡å—åˆ’åˆ†

### 3.1 åç«¯æ¨¡å—ç»“æ„

```
backend/
â””â”€â”€ src/main/java/com/lineage/
    â”œâ”€â”€ Application.java                   # Spring Bootå¯åŠ¨ç±»
    â”‚
    â”œâ”€â”€ controller/                        # æ§åˆ¶å™¨å±‚
    â”‚   â”œâ”€â”€ LineageController.java         # è¡€ç¼˜åˆ†æAPI
    â”‚   â”œâ”€â”€ MetadataController.java        # å…ƒæ•°æ®ç®¡ç†API
    â”‚   â”œâ”€â”€ KettleController.java          # Kettleè§£æAPI
    â”‚   â””â”€â”€ ExportController.java          # å¯¼å‡ºAPI
    â”‚
    â”œâ”€â”€ service/                           # æœåŠ¡å±‚
    â”‚   â”œâ”€â”€ DruidParserService.java        # Druid SQLè§£ææœåŠ¡
    â”‚   â”œâ”€â”€ MetadataService.java           # å…ƒæ•°æ®CRUDæœåŠ¡
    â”‚   â”œâ”€â”€ KettleParserService.java       # Kettle XMLè§£ææœåŠ¡
    â”‚   â”œâ”€â”€ ExportService.java             # Excelå¯¼å‡ºæœåŠ¡
    â”‚   â””â”€â”€ BatchService.java              # æ‰¹é‡å¤„ç†æœåŠ¡
    â”‚
    â”œâ”€â”€ core/                              # æ ¸å¿ƒå¼•æ“
    â”‚   â”œâ”€â”€ LineageAnalyzer.java           # è¡€ç¼˜åˆ†æä¸»ç±»
    â”‚   â”œâ”€â”€ visitor/
    â”‚   â”‚   â””â”€â”€ LineageVisitor.java        # ASTè®¿é—®è€…
    â”‚   â”œâ”€â”€ tracker/
    â”‚   â”‚   â””â”€â”€ FieldDependencyTracker.java # å­—æ®µä¾èµ–è¿½è¸ªå™¨
    â”‚   â”œâ”€â”€ dialect/
    â”‚   â”‚   â””â”€â”€ DbTypeResolver.java        # æ•°æ®åº“æ–¹è¨€è§£æ
    â”‚   â””â”€â”€ graph/
    â”‚       â””â”€â”€ LineageGraph.java          # è¡€ç¼˜å›¾æ•°æ®ç»“æ„
    â”‚
    â”œâ”€â”€ entity/                            # å®ä½“ç±»
    â”‚   â”œâ”€â”€ MetadataDatabase.java
    â”‚   â”œâ”€â”€ MetadataTable.java
    â”‚   â”œâ”€â”€ MetadataColumn.java
    â”‚   â””â”€â”€ LineageAnalysis.java
    â”‚
    â”œâ”€â”€ dto/                               # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”‚   â”œâ”€â”€ request/
    â”‚   â”‚   â”œâ”€â”€ AnalyzeRequest.java        # åˆ†æè¯·æ±‚
    â”‚   â”‚   â””â”€â”€ MetadataImportRequest.java
    â”‚   â””â”€â”€ response/
    â”‚       â”œâ”€â”€ LineageResult.java         # è¡€ç¼˜ç»“æœ
    â”‚       â””â”€â”€ CommonResponse.java        # ç»Ÿä¸€å“åº”æ ¼å¼
    â”‚
    â”œâ”€â”€ mapper/                            # MyBatis Mapper
    â”‚   â”œâ”€â”€ MetadataMapper.java
    â”‚   â””â”€â”€ LineageMapper.java
    â”‚
    â””â”€â”€ config/                            # é…ç½®ç±»
        â”œâ”€â”€ DruidConfig.java
        â”œâ”€â”€ WebConfig.java
        â””â”€â”€ AsyncConfig.java
```

### 3.2 å‰ç«¯æ¨¡å—ç»“æ„

```
frontend/
â”œâ”€â”€ index.html                    # ä¸»é¡µé¢
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ style.css                 # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ layout.css                # å¸ƒå±€æ ·å¼
â”‚   â””â”€â”€ components.css            # ç»„ä»¶æ ·å¼
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ main.js                   # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ api.js                    # APIå°è£…
â”‚   â”œâ”€â”€ visualizer.js             # è¡€ç¼˜å›¾å¯è§†åŒ– (G6)
â”‚   â”œâ”€â”€ table-view.js             # è¡¨æ ¼è§†å›¾
â”‚   â”œâ”€â”€ tree-view.js              # æ ‘å½¢è§†å›¾
â”‚   â””â”€â”€ utils.js                  # å·¥å…·å‡½æ•°
â””â”€â”€ lib/                          # ç¬¬ä¸‰æ–¹åº“
    â”œâ”€â”€ g6.min.js
    â”œâ”€â”€ axios.min.js
    â”œâ”€â”€ datatables.min.js
    â””â”€â”€ jstree.min.js
```

---

## 4. æ ¸å¿ƒç®—æ³•è®¾è®¡

### 4.1 å­—æ®µè¡€ç¼˜åˆ†æç®—æ³•

**è¾“å…¥**: SQLå­—ç¬¦ä¸²ã€æ•°æ®åº“ç±»å‹  
**è¾“å‡º**: å­—æ®µè¡€ç¼˜å…³ç³»å›¾ (JSON)

**ç®—æ³•æ­¥éª¤**:

```java
public LineageResult analyze(String sql, String dbType) {
    // æ­¥éª¤1: è§£æSQLä¸ºAST
    SQLStatement stmt = DruidParser.parse(sql, DbType.of(dbType));
    
    // æ­¥éª¤2: åˆ›å»ºè®¿é—®è€…
    LineageVisitor visitor = new LineageVisitor();
    stmt.accept(visitor);
    
    // æ­¥éª¤3: æ„å»ºè¡€ç¼˜å›¾
    LineageGraph graph = new LineageGraph();
    
    for (SelectItem item : visitor.getSelectItems()) {
        String targetField = item.getAlias();
        List<SourceField> sources = resolveFieldSources(item.getExpr());
        graph.addEdge(sources, targetField);
    }
    
    // æ­¥éª¤4: è¿”å›ç»“æœ
    return graph.toResult();
}

// é€’å½’è§£æè¡¨è¾¾å¼
private List<SourceField> resolveFieldSources(SQLExpr expr) {
    if (expr instanceof SQLIdentifierExpr) {
        // ç®€å•å­—æ®µ: col1
        return resolveSingleColumn((SQLIdentifierExpr) expr);
    } else if (expr instanceof SQLPropertyExpr) {
        // é™å®šå­—æ®µ: t1.col1
        return resolveQualifiedColumn((SQLPropertyExpr) expr);
    } else if (expr instanceof SQLMethodInvokeExpr) {
        // å‡½æ•°: sum(col1)
        List<SourceField> result = new ArrayList<>();
        for (SQLExpr arg : ((SQLMethodInvokeExpr) expr).getArguments()) {
            result.addAll(resolveFieldSources(arg));  // é€’å½’
        }
        return result;
    } else if (expr instanceof SQLBinaryOpExpr) {
        // è¿ç®—: col1 + col2
        SQLBinaryOpExpr binExpr = (SQLBinaryOpExpr) expr;
        List<SourceField> result = new ArrayList<>();
        result.addAll(resolveFieldSources(binExpr.getLeft()));   // é€’å½’
        result.addAll(resolveFieldSources(binExpr.getRight()));  // é€’å½’
        return result;
    }
    // ... å…¶ä»–è¡¨è¾¾å¼ç±»å‹
    return Collections.emptyList();
}
```

### 4.2 Kettleæ–‡ä»¶è§£æç®—æ³•

```java
public List<String> extractSQLFromKTR(File ktrFile) {
    Document doc = SAXReader.read(ktrFile);
    Element root = doc.getRootElement();
    
    List<String> sqlList = new ArrayList<>();
    List<Element> steps = root.selectNodes("//step");
    
    for (Element step : steps) {
        String stepType = step.elementText("type");
        
        // TableInputæ­¥éª¤åŒ…å«SQL
        if ("TableInput".equals(stepType)) {
            String sql = step.elementText("sql");
            if (StringUtils.isNotBlank(sql)) {
                sqlList.add(sql);
            }
        }
        // å…¶ä»–åŒ…å«SQLçš„æ­¥éª¤ç±»å‹...
    }
    
    return sqlList;
}
```

---

## 5. æŠ€æœ¯é£é™©è¯„ä¼°

| é£é™© | ç­‰çº§ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|------|------|------|---------|
| **Druidå¯¹Spark SQLæ”¯æŒä¸å®Œæ•´** | ğŸŸ¡ ä¸­ | éƒ¨åˆ†Sparkç‰¹æœ‰è¯­æ³•æ— æ³•è§£æ | MVPé˜¶æ®µé‡ç‚¹æ”¯æŒHive/MySQLï¼ŒSparkä½œä¸ºäºŒæœŸæ‰©å±• |
| **è¶…å¤§SQLæ€§èƒ½é—®é¢˜** | ğŸ”´ é«˜ | 1000+è¡ŒSQLå¯èƒ½è§£æè¶…æ—¶ | å®æ–½å¼‚æ­¥å¤„ç†ã€ASTç¼“å­˜ã€åˆ†æ®µè§£æ |
| **Kettleç‰ˆæœ¬å…¼å®¹æ€§** | ğŸŸ¡ ä¸­ | ä¸åŒç‰ˆæœ¬XMLç»“æ„å·®å¼‚ | æ”¯æŒä¸»æµç‰ˆæœ¬ï¼ˆ8.x/9.xï¼‰ï¼Œæä¾›å…¼å®¹æ€§æ£€æŸ¥ |
| **å¤æ‚SQLè¾¹ç•Œæƒ…å†µ** | ğŸŸ¡ ä¸­ | ç‰¹æ®ŠSQLè¯­æ³•é—æ¼ | å»ºç«‹æµ‹è¯•ç”¨ä¾‹åº“ï¼Œè¿­ä»£è¡¥å…… |
| **å¤šæ•°æ®åº“æ–¹è¨€å·®å¼‚** | ğŸŸ¡ ä¸­ | åŒä¸€è¯­æ³•ä¸åŒæ•°æ®åº“è¯­ä¹‰ä¸åŒ | æ–¹è¨€éš”ç¦»ï¼Œåˆ†åˆ«å¤„ç† |
| **å‰ç«¯å¤§å›¾æ¸²æŸ“æ€§èƒ½** | ğŸŸ¢ ä½ | 20+è¡¨çš„DAGå›¾å¯èƒ½å¡é¡¿ | G6è™šæ‹Ÿæ¸²æŸ“ã€èŠ‚ç‚¹æŠ˜å  |

---

## 6. éåŠŸèƒ½æ€§éœ€æ±‚

### 6.1 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹è¯•æ–¹æ³• |
|------|------|---------|
| ç®€å•SQLè§£æ | < 100ms | å•è¡¨SELECTï¼Œ10ä¸ªå­—æ®µ |
| å¤æ‚SQLè§£æ | < 600s | 1000è¡ŒSQLï¼Œ20+è¡¨ |
| æ‰¹é‡å¤„ç† | 100æ¡SQL/10min | å¼‚æ­¥é˜Ÿåˆ—å¤„ç† |
| å¹¶å‘æ”¯æŒ | 10ç”¨æˆ·åŒæ—¶ä½¿ç”¨ | JMeterå‹æµ‹ |
| å†…å­˜å ç”¨ | < 1GB | å¤§SQLè§£æ |

### 6.2 å¯é æ€§

- **æ•°æ®å‡†ç¡®æ€§**: å­—æ®µè¡€ç¼˜å‡†ç¡®ç‡ > 95%
- **å®¹é”™æ€§**: SQLè¯­æ³•é”™è¯¯æ—¶è¿”å›å‹å¥½æç¤ºï¼Œä¸å´©æºƒ
- **æ—¥å¿—å®Œæ•´æ€§**: æ‰€æœ‰æ“ä½œè®°å½•æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥

### 6.3 å¯ç»´æŠ¤æ€§

- **ä»£ç è§„èŒƒ**: éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ
- **æ³¨é‡Šè¦†ç›–**: æ ¸å¿ƒç®—æ³•ç±» > 80%
- **å•å…ƒæµ‹è¯•**: è¦†ç›–ç‡ > 80%

---

## 7. éƒ¨ç½²æ¶æ„

### 7.1 å†…ç½‘éƒ¨ç½²æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å†…ç½‘æœåŠ¡å™¨ (Linux/Windows)     â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Nginx (80/443)                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ /        â†’ é™æ€å‰ç«¯èµ„æº     â”‚ â”‚
â”‚  â”‚  â””â”€ /api/*   â†’ åç«¯Spring Boot  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â†“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Spring Boot (8080)              â”‚ â”‚
â”‚  â”‚  - JVMå‚æ•°: -Xms512m -Xmx2g     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â†“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MySQL (3306)                    â”‚ â”‚
â”‚  â”‚  - å…ƒæ•°æ®åº“: lineage_metadata    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 æ‰“åŒ…éƒ¨ç½²

```bash
# åç«¯æ‰“åŒ…
mvn clean package -DskipTests

# ç”Ÿæˆ: backend/target/sql-lineage-analyzer-1.0.0.jar

# è¿è¡Œ
java -jar sql-lineage-analyzer-1.0.0.jar \
  --spring.profiles.active=prod \
  --server.port=8080
```

---

## 8. å¼€å‘ç¯å¢ƒè¦æ±‚

| ç¯å¢ƒ | ç‰ˆæœ¬è¦æ±‚ |
|------|---------|
| JDK | 8+ |
| Maven | 3.6+ |
| IDE | IntelliJ IDEA 2021+ |
| æ•°æ®åº“ | MySQL 8.0+ (ç”Ÿäº§) / H2 (å¼€å‘) |
| æµè§ˆå™¨ | Chrome 90+ / Firefox 88+ / Edge 90+ |

---

## 9. åç»­ä¼˜åŒ–æ–¹å‘

### ç¬¬äºŒæœŸè®¡åˆ’

1. **æ›´å¤šSQLç±»å‹æ”¯æŒ**
   - CREATE VIEW è¡€ç¼˜åˆ†æ
   - INSERT INTO SELECT æ•°æ®å†™å…¥è¡€ç¼˜
   - MERGE/UPSERT è¯­å¥

2. **æ€§èƒ½ä¼˜åŒ–**
   - SQLè§£æç»“æœç¼“å­˜ï¼ˆRedisï¼‰
   - å¢é‡åˆ†æï¼ˆåªåˆ†æå˜åŒ–éƒ¨åˆ†ï¼‰
   - åˆ†å¸ƒå¼å¤„ç†ï¼ˆå¤šèŠ‚ç‚¹å¹¶è¡Œï¼‰

3. **åŠŸèƒ½å¢å¼º**
   - è¡€ç¼˜å½±å“åˆ†æï¼ˆå­—æ®µä¿®æ”¹å½±å“è¯„ä¼°ï¼‰
   - è¡€ç¼˜å¯¹æ¯”ï¼ˆç‰ˆæœ¬å·®å¼‚ï¼‰
   - è¡€ç¼˜æœç´¢ï¼ˆæ‰¾å‡ºæŸå­—æ®µçš„æ‰€æœ‰å¼•ç”¨ï¼‰

4. **ä¼ä¸šçº§ç‰¹æ€§**
   - å¤šç§Ÿæˆ·éš”ç¦»
   - æƒé™ç®¡ç†
   - å®¡è®¡æ—¥å¿—

---

## é™„å½•: æŠ€æœ¯é€‰å‹å¯¹æ¯”

### A1. SQLè§£æå™¨å¯¹æ¯”

| è§£æå™¨ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ç»“è®º |
|-------|------|------|------|
| **Alibaba Druid** | âœ… å¤šæ–¹è¨€æ”¯æŒ<br>âœ… å›½äº§æ–‡æ¡£å‹å¥½<br>âœ… ASTè®¿é—®è€…æ¨¡å¼ | âŒ Spark SQLæ”¯æŒæœ‰é™ | âœ… **é€‰æ‹©** |
| Apache Calcite | âœ… åŠŸèƒ½å¼ºå¤§<br>âœ… æ‰©å±•æ€§å¥½ | âŒ å­¦ä¹ æ›²çº¿é™¡å³­<br>âŒ æ–‡æ¡£å¤æ‚ | âŒ ä¸é€‰ |
| JSqlParser | âœ… çº¯Java<br>âœ… è½»é‡çº§ | âŒ æ–¹è¨€æ”¯æŒå°‘<br>âŒ å¤æ‚SQLè§£æå¼± | âŒ ä¸é€‰ |

### A2. å‰ç«¯å›¾å½¢åº“å¯¹æ¯”

| å›¾å½¢åº“ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ç»“è®º |
|-------|------|------|------|
| **AntV G6** | âœ… ä¸“ä¸šå›¾å½¢å¼•æ“<br>âœ… å›½äº§æ”¯æŒå¥½<br>âœ… DAGå¸ƒå±€ä¼˜ç§€ | âŒ ä½“ç§¯è¾ƒå¤§(~200KB) | âœ… **é€‰æ‹©** |
| D3.js | âœ… çµæ´»å¼ºå¤§<br>âœ… ç”Ÿæ€ä¸°å¯Œ | âŒ å­¦ä¹ æˆæœ¬é«˜<br>âŒ éœ€è¦è‡ªå·±å®ç°å¸ƒå±€ | âŒ ä¸é€‰ |
| Cytoscape.js | âœ… å›¾ç®—æ³•ä¸°å¯Œ | âŒ æ ·å¼å®šåˆ¶å¤æ‚ | âŒ ä¸é€‰ |

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥**: è¿›å…¥æ•°æ®åº“è®¾è®¡é˜¶æ®µ (T0.2.1.1)
